---
title: 스레드와 동기화 개념
date: 2020-11-14 14:14:11
category: 
- Reversing
- Windows
tags:
- Reversing
---

## Thread

Thread는 프로세스가 할당 받은 자원을 이용하는 실행의 단위

### Multi Threaded

여러 개의 작업을 처리하기 위해 멀티 스레드를 사용
- 스레드 상호 통신 & 동기화


## 동기화

공유 자원에 대한 스레드의 접근을 제어하는 방법으로 다수의 스레드가 동일한 자원을 읽을 때 문제가 발생하므로 동기화하여 서로 충돌하지 않게 해야한다.
- Critical Section : 동일 프로세스의 스레드를 동기화
- Mutex, Semaphore, Event: 서로 다른 프로세스의 스레드 동기화

### 단일 스레드와 멀티 스레드

![img](/img/thread.PNG)
단일 스레드는 작업 공간을 하나로 쓰지만, 멀티 스레드는 작업 공간을 나누어서 각 스레드마다 독립적으로 쓴다.

### Synchronization MFC 함수

- CMutex, CCriticalSection, CSemaphore, CEvent : 동기화 클래스
- CSingleLock(Unlock) / CMultiLock(Unlock) : 리소스 잠금 / 해제

모든 스레드 동기화 클래스는 CSyncObject 클래스에서 상속 받는다.

### 스레드 브레이크 포인트

동기화가 되는 부분에 브레이크 포인트를 걸게되면 우리가 원하는 동작이 제대로 안될 수 가 있다. 따라서 하나의 프로세스를 대상으로 나머지 스레드는 동작을 멈추고 하나씩 실행하여 분석하여야 한다. 하지만 정지 시켜놓은 스레드가 중요한 작업(스레드간 상호작용)을 하지 않는다는 전제 조건이 있어야 한다.

### Windbg 스레드 분석

|명령어|설명|
|:---:|:---|
|~*|모든 스레드를 보여준다|
|~#|현재 스레드를 보여준다|
|~g|현재 스레드만 실행시키고 나머지 스레드는 잠시 중지 시킨다|
|~*kb|스레드의 스택을 보여준다, 스레드의 주소를 찾을 수 있다|

~g를 통하여 현재 스레드만 실행시키면서 분석을 진행한다.
