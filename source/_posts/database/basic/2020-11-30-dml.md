---
title: DML
date: 2020-11-30 15:18:55
tags:
- Database Query
- UPDATE
- INSERT
- DELETE
- MERGE
category:
- Database 
---

## DML

- 데이터의 선택,삽입,수정,삭제에 사용
- SELECT,INSERT,UPDATE,DELETE
- 트랜잭션(데이터 변경의 최소 단위)을 발생시킨다.

### INSERT

```
INSERT INTO [table] VALUES (값1,값2..)
INSERT INTO [table](Col1,Col2) VALUES (값1,값2..)
```
- IDENTITY : 테이블 만들시 지정시 자동으로 생성될 때 값이 올라간다.
  - IDENTITY의 올라가는 숫자를 바꾸고 싶을 떄는 `SET IDENTITY_INSERT [TABLE] [ON/OFF]`를 써주면 된다. ON은 값을 바꿀 수 있고 OFF는 다시 원상태로 복귀 된다.

- DEFAULT : 만든 테이블의 값에 입력이 없을 떄 DEFAULT값으로 생성한 값이 생성된다.

```
CREATE TABLE testTBL3(
	id INT IDENTITY,
	userName NCHAR(3),
	age INT,
	nation NCHAR(4) DEFAULT N'대한민국');

INSERT INTO testTBL3 VALUES(N'토마스',27,DEFAULT);
INSERT INTO testTBL3 VALUES(N'고든',33,N'미국');

SELECT * from testTBL3;
```

![INSERT](/img/insert.PNG)

#### INSERT로 복사

SELECT INTO랑 같은 일을 한다.

```
INSERT INTO 저장할 테이블 이름(열1,열2..)
	SELECT 열1,열2 FROM 복사할 테이블 이름
```
```
CREATE TABLE storedTBL2 (
	id int,
	Fname char(4),
	Lname char(4)
)

CREATE TABLE copyTBL2(
	id int,
	Fname char(4),
	Lname char(4)
)

INSERT INTO copyTBL2 VALUES(1,'Kim','Jeam')
INSERT INTO copyTBL2 VALUES(2,'Jin','Teah')

INSERT INTO storedTBL2 SELECT id,Fname,Lname FROM copyTBL2;

SELECT * FROM copyTBL2;
SELECT * FROM storedTBL2;
```

![INSERT](/img/insertCopy.PNG)

### UPDATE

데이터를 수정하는 쿼리이다.

```
UPDATE 테이블 이름 
SET 열1=값1,열2=값2
WHERE 조건
```

### DELETE

데이터 삭제 

```
DELETE FROM 테이블 이름
WHERE 조건
```

### MERGE

Merge는 중요한 데이터가 있는 테이블을 변경하기전에 미리 여분의 테이블을 만들어 만든 테이블에 변경 값을 써주고 정확하다 싶을 떄 합병해주는 구문이다.

```

CREATE TABLE changeTBL
(
	changeType NCHAR(4),
	userID char(8),
	userName nvarchar(10),
	addr nchar(2)
)

INSERT INTO changeTBL VALUES
(N'신규가입','TPN',N'티파니',N'미국'),
(N'주소변경','LSG',null,N'제주')

SELECT * FROM changeTBL;

MERGE memberTBL AS M
USING changeTBL AS C
ON M.userID=C.userID
WHEN NOT MATCHED AND changeType = N'신규가입' THEN
INSERT (userID,userName,addr) VALUES(C.userID,C.userName,C.addr)
WHEN MATCHED AND changeType = N'주소변경' THEN
UPDATE SET M.addr=C.addr;

SELECT * FROM memberTBL;
```

```
MERGE [합병할 테이블]
USING [데이터가 바뀐 테이블]
ON [열1 = 열1]  //맞는지 확인
WHEN NOT MATCHED AND 조건 THEN // 열이 맞지 않을 시
WHEN MATCED AND 조건 THEN // 열이 맞을 시
```
